:PROPERTIES:
:ID:       f03eafc7-83c7-49e0-8f08-57436ea5204a
:END:
#+title: curve finance

* N coins case
For a pool of N *stable* coins the C.Prod.MM & the C.Price.MM are written respectively:

- I_a(x) = \sum_j x_j - K = 0
- I_b(x) = \prod_j x_j - (K/N)^N = 0

with j ranging from 1 to N.

The exchange price of coin I for coin J is given by P_{ij} = - \partial x_i/ \partial x_j = 1 (because they are
stable coins).
Suppose \Delta x_i is the amount trader is willing to buy/sell to the AMM.
After each executes the following AMM

1. x_i^{new} = x_i^{old} - \Delta x_i, 
2. x_j^{new} for j = 1..N, j \ne i solve I(x_1^{new}, ..., x_N^{new}) = 0 (using Newton's method for example)
3. quantity given to trader x_j^{old} - x_j^{new }= \Delta x_j

* Curve stable swap
Curve finance tries to make the invariant for small quantities similar to C.Prod.MM
and similar to C.Price.MM for large quantities.

Suppose \gamma is the leverage amount, when leverage tradig I for J  we are willing to trade amount
\gamma * \Delta x_i for amount \gamma * \Delta x_j. Now multiply C.Price.MM invariant by \gamma K^(N-1) and add the resulting
quantity to the C.Prod.MM:

\gamma * K^{N-1} * \sum_j x_j + \prod_j x_j = \gamma * K^N * (N + 1)

This is the *Stableswap* invariant, when \gamma = 0 we have the C.Prod.MM invariant & when \gamma \approx \infty we
have the C.Price.MM invariant.
The actual stable swap invariant is obtained by setting:

- \gamma = A \gamma_0 c^2/ (c + 1 - \gamma_0)^2
- \gamma_0 = \prod_j x_j N^N/ K^N

 With A amplification coefficient, and c> 0 has the meaning of distance between the C.Price.MM
 curve and the C.Prod.MM curve
